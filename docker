FROM python:3.9-slim

RUN apt-get update && apt-get install -y \
    tor \
    wget \
    unzip \
    xvfb

RUN wget https://geolite.maxmind.com/download/geoip/database/GeoLite2-City.tar.gz && \
    tar -xzf GeoLite2-City.tar.gz && \
    mv GeoLite2-City_*/GeoLite2-City.mmdb . && \
    rm -rf GeoLite2-City_*

COPY requirements.txt .
RUN pip install -r requirements.txt

RUN playwright install chromium

COPY . .

CMD ["sh", "-c", "tor & Xvfb :99 -screen 0 1920x1080x16 & export DISPLAY=:99 && python main.py"]
